import{katex as y}from"@mdit/plugin-katex-slim";import{createMathjaxInstance as $,mathjax as f}from"@mdit/plugin-mathjax-slim";import{ensureEndingSlash as M,Logger as v,getModulePath as C,deepAssign as E,isModuleAvailable as k,addCustomElement as F}from"@vuepress/helper";import{path as I,getDirname as L,logger as x,colors as d}from"vuepress/utils";const P=import.meta.dirname||L(import.meta.url),w=M(I.resolve(P,"../client")),u="@vuepress/plugin-markdown-math";new v(u);const b=async(s,e,i)=>{let t="";return e==="katex"?t+=`import "${C("katex/dist/katex.min.css",import.meta)}";
import "${w}styles/katex.css";
${i.copy?`import { useKatexCopy } from "${w}composables/useKatexCopy.js";

export default {
  setup: () => {
    useKatexCopy();
  }
};
`:""}`:t+=`import './mathjax.css';
`,s.writeTemp("markdown-math/config.js",t)},N=`mjx-container {
  overflow: auto hidden;
}

mjx-assistive-mml {
  display: none;
}
`,T=async(s,e)=>{await s.writeTemp("markdown-math/mathjax.css",`${await e.outputStyle()}
${N}`)},A=(s={})=>e=>{const i=E({},e.options.markdown.math,s);e.options.markdown.math=i;const{type:t,...l}=i,h=k("@mathjax/src",import.meta),j=k("katex",import.meta),n=t==="katex"&&j?"katex":t==="mathjax"&&h||h?"mathjax":j?"katex":null;if(!n||t&&n!==t){const r={katex:"katex",mathjax:"@mathjax/src"};return x.error(n?`type is "${t}", but "${r[t]}" is not installed`:"No math renderer found, please install @mathjax/src or katex"),{name:u}}let m;return{name:u,extendsBundlerOptions:r=>{n==="mathjax"&&F(r,e,/^mjx-/)},extendsMarkdown:async r=>{n==="mathjax"?(m=await $({...l,transformer:a=>a.replace(/^<mjx-container/,"<mjx-container v-pre")}),r.use(f,m),r.use(a=>{const c=a.render.bind(a);a.render=(p,o)=>{const g=c(p,o);return m?.reset(),g}})):(l.mhchem&&await import("@mdit/plugin-katex-slim/mhchem"),r.use(y,{logger:(a,c,p,{filePathRelative:o})=>{a!=="newLineInDisplayMode"&&(a==="unicodeTextInMathMode"?x.warn(`Found unicode character ${p.text} inside tex${o?` in ${d.cyan(o)}`:""}. You should use ${d.magenta(`\\text{${p.text}}`)}`):x.warn(`${c}.${o?`
Found in ${d.cyan(o)}`:""}`))},...l,transformer:a=>a.replace(/^(<[a-z]+ )/g,"$1v-pre ")}))},onPrepared:async()=>{n==="mathjax"&&(await T(e,m),e.env.isBuild&&(m=null))},clientConfigFile:()=>b(e,n,l)}};export{A as markdownMathPlugin};
//# sourceMappingURL=index.js.map
