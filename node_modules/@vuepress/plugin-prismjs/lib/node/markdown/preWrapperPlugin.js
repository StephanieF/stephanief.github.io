import { resolveLanguage } from '../utils/index.js';
export const preWrapperPlugin = (md, { preWrapper = true } = {}) => {
    const rawFence = md.renderer.rules.fence;
    md.renderer.rules.fence = (...args) => {
        let result = rawFence(...args);
        const [tokens, idx, { langPrefix }] = args;
        const token = tokens[idx];
        // get token info
        const info = token.info ? md.utils.unescapeAll(token.info).trim() : '';
        // resolve language from token info
        const language = resolveLanguage(info);
        const languageClass = `${langPrefix}${language.name}`;
        result = result.replace(/<code[^]*?>/, `<code class="${languageClass}">`);
        if (!preWrapper || !result.startsWith('<pre')) {
            return result;
        }
        /**
         * Add information to dataset for current code block.
         */
        return `<div class="${languageClass}" data-highlighter="prismjs" data-ext="${language.ext}">${result.replace(` class="${languageClass}"`, '')}</div>`;
    };
};
