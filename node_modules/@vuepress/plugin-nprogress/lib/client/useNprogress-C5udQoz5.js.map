{"version":3,"file":"useNprogress-C5udQoz5.js","sources":["../../src/client/nprogress.ts","../../src/client/composables/useNprogress.ts"],"sourcesContent":["/**\n * NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress\n * @license MIT\n */\n\nimport { entries, isDef } from '@vuepress/helper/client'\n\n// Forked and modified from nprogress v0.2.0\n\nconst addClass = (element: Element, name: string): void => {\n  element.classList.add(name)\n}\n\nconst removeClass = (element: Element, name: string): void => {\n  element.classList.remove(name)\n}\n\nconst removeElement = (element?: Element | null): void => {\n  element?.remove()\n}\n\nconst clamp = (num: number, min: number, max: number): number => {\n  if (num < min) return min\n  if (num > max) return max\n  return num\n}\n\nconst toBarPercent = (num: number): number => (-1 + num) * 100\n\nconst queue = (() => {\n  const pending: ((next: () => void) => void)[] = []\n\n  const nextStep = (): void => {\n    const fn = pending.shift()\n\n    if (fn) {\n      fn(nextStep)\n    }\n  }\n\n  return (fn: (next: () => void) => void): void => {\n    pending.push(fn)\n    if (pending.length === 1) nextStep()\n  }\n})()\n\nconst camelCase = (content: string): string =>\n  content\n    .replace(/^-ms-/, 'ms-')\n    .replaceAll(/-([\\da-z])/gi, (_, letter: string) => letter.toUpperCase())\n\nconst addStyle = (() => {\n  const cssPrefixes = ['Webkit', 'O', 'Moz', 'ms']\n  const cssProps: Record<string, string> = {}\n\n  const getVendorProp = (name: string): string => {\n    const { style } = document.body\n\n    if (name in style) return name\n\n    const capName = name.charAt(0).toUpperCase() + name.slice(1)\n\n    let index = cssPrefixes.length\n\n    while (index--) {\n      const vendorName = `${cssPrefixes[index]}${capName}`\n\n      if (vendorName in style) return vendorName\n    }\n\n    return name\n  }\n\n  const getStyleProp = (name: string): string => {\n    const finalizedName = camelCase(name)\n\n    return (cssProps[finalizedName] ??= getVendorProp(finalizedName))\n  }\n\n  const applyCss = (\n    element: HTMLElement,\n    prop: string,\n    value: string,\n  ): void => {\n    ;(element.style as unknown as Record<string, string>)[getStyleProp(prop)] =\n      value\n  }\n\n  return (\n    element: HTMLElement,\n    properties: Record<string, string | undefined>,\n  ): void => {\n    for (const [prop, value] of entries(properties)) {\n      if (isDef(value)) applyCss(element, prop, value)\n    }\n  }\n})()\n\ninterface NProgressSettings {\n  minimum: number\n  template: string\n  easing: string\n  speed: number\n  trickle: boolean\n  trickleRate: number\n  trickleSpeed: number\n  parent: string\n  barSelector: string\n}\n\ninterface NProgress {\n  percent: number | null\n\n  set(number: number): NProgress\n  isStarted(): boolean\n  start(): NProgress\n  done(force?: boolean): NProgress\n  increase(amount?: number): NProgress\n  trickle(): NProgress\n\n  /* Internal */\n\n  render(fromStart?: boolean): HTMLDivElement\n  remove(): void\n  isRendered(): boolean\n}\n\nconst SETTINGS: NProgressSettings = {\n  minimum: 0.08,\n  easing: 'ease',\n  speed: 200,\n  trickle: true,\n  trickleRate: 0.02,\n  trickleSpeed: 800,\n  barSelector: '[role=\"bar\"]',\n  parent: 'body',\n  template: '<div class=\"bar\" role=\"bar\"></div>',\n}\n\nexport const nprogress: NProgress = {\n  percent: null,\n\n  isRendered: () => Boolean(document.querySelector('#nprogress')),\n\n  set: (progress) => {\n    const { speed, easing } = SETTINGS\n\n    const inProgress = nprogress.isStarted()\n    const newPercent = clamp(progress, SETTINGS.minimum, 1)\n\n    nprogress.percent = newPercent === 1 ? null : newPercent\n\n    const nprogressElement = nprogress.render(!inProgress)\n    const barElement = nprogressElement.querySelector<HTMLElement>(\n      SETTINGS.barSelector,\n    )!\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    nprogressElement.offsetWidth /* Repaint */\n\n    queue((next) => {\n      // Add transition\n      addStyle(barElement, {\n        transform: `translate3d(${toBarPercent(newPercent)}%,0,0)`,\n        transition: `all ${speed}ms ${easing}`,\n      })\n\n      if (newPercent === 1) {\n        // Fade out\n        addStyle(nprogressElement, {\n          transition: 'none',\n          opacity: '1',\n        })\n        // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n        nprogressElement.offsetWidth /* Repaint */\n\n        setTimeout(() => {\n          addStyle(nprogressElement, {\n            transition: `all ${speed}ms linear`,\n            opacity: '0',\n          })\n          setTimeout(() => {\n            nprogress.remove()\n            next()\n          }, speed)\n        }, speed)\n      } else {\n        setTimeout(() => {\n          next()\n        }, speed)\n      }\n    })\n\n    return nprogress\n  },\n\n  isStarted: () => typeof nprogress.percent === 'number',\n\n  start: () => {\n    if (!nprogress.percent) nprogress.set(0)\n\n    const work = (): void => {\n      setTimeout(() => {\n        if (!nprogress.percent) return\n        nprogress.trickle()\n        work()\n      }, SETTINGS.trickleSpeed)\n    }\n\n    if (SETTINGS.trickle) work()\n\n    return nprogress\n  },\n\n  done: (force) => {\n    if (!force && !nprogress.percent) return nprogress\n    return nprogress.increase(0.3 + 0.5 * Math.random()).set(1)\n  },\n\n  increase: (amount) => {\n    let { percent } = nprogress\n\n    if (!percent) {\n      return nprogress.start()\n    }\n\n    percent = clamp(\n      percent +\n        (typeof amount === 'number'\n          ? amount\n          : (1 - percent) * clamp(Math.random() * percent, 0.1, 0.95)),\n      0,\n      0.994,\n    )\n\n    return nprogress.set(percent)\n  },\n\n  trickle: () => nprogress.increase(Math.random() * SETTINGS.trickleRate),\n\n  render: (fromStart) => {\n    if (nprogress.isRendered()) {\n      return document.querySelector<HTMLDivElement>('#nprogress')!\n    }\n\n    addClass(document.documentElement, 'nprogress-busy')\n\n    const nprogressElement = document.createElement('div')\n\n    nprogressElement.id = 'nprogress'\n    nprogressElement.innerHTML = SETTINGS.template\n\n    const barElement = nprogressElement.querySelector<HTMLElement>(\n      SETTINGS.barSelector,\n    )!\n    const parentElement = document.querySelector<HTMLElement>(SETTINGS.parent)\n\n    const percent = fromStart ? '-100' : toBarPercent(nprogress.percent ?? 0)\n\n    addStyle(barElement, {\n      transition: 'all 0 linear',\n      transform: `translate3d(${percent}%,0,0)`,\n    })\n\n    if (parentElement) {\n      if (parentElement !== document.body) {\n        addClass(parentElement, 'nprogress-custom-parent')\n      }\n\n      parentElement.append(nprogressElement)\n    }\n\n    return nprogressElement\n  },\n\n  remove: () => {\n    removeClass(document.documentElement, 'nprogress-busy')\n    removeClass(\n      document.querySelector(SETTINGS.parent)!,\n      'nprogress-custom-parent',\n    )\n    removeElement(document.querySelector('#nprogress'))\n  },\n}\n","import { onMounted } from 'vue'\nimport { useRouter } from 'vuepress/client'\nimport { nprogress } from '../nprogress.js'\n\nimport '../styles/vars.css'\nimport '../styles/nprogress.css'\n\n/**\n * Use nprogress\n *\n * 使用 nprogress\n */\nexport const useNprogress = (): void => {\n  onMounted(() => {\n    // get vue-router instance\n    const router = useRouter()\n\n    // record which pages have been loaded\n    const loadedPages = new Set()\n\n    // add path of current page as initial value\n    // oxlint-disable-next-line unicorn/no-immediate-mutation\n    loadedPages.add(router.currentRoute.value.path)\n\n    // show progress bar before navigation\n    router.beforeEach((to) => {\n      if (!loadedPages.has(to.path)) {\n        nprogress.start()\n      }\n    })\n\n    // hide progress bar after navigation\n    router.afterEach((to) => {\n      loadedPages.add(to.path)\n      nprogress.done()\n    })\n  })\n}\n"],"names":["addClass","element","name","removeClass","removeElement","clamp","num","min","max","toBarPercent","queue","pending","nextStep","fn","camelCase","content","_","letter","addStyle","cssPrefixes","cssProps","getVendorProp","style","capName","index","vendorName","getStyleProp","finalizedName","applyCss","prop","value","properties","entries","isDef","SETTINGS","nprogress","progress","speed","easing","inProgress","newPercent","nprogressElement","barElement","next","work","force","amount","percent","fromStart","parentElement","useNprogress","onMounted","router","useRouter","loadedPages","to"],"mappings":"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"}